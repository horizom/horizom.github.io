<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Horizom Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Horizom Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-141789564-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Introduction | Horizom</title><meta data-react-helmet="true" property="og:url" content="https://horizom.github.io/docs/framework/auth/index"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Introduction | Horizom"><meta data-react-helmet="true" name="description" content="Authentication for PHP. Simple, lightweight and secure."><meta data-react-helmet="true" property="og:description" content="Authentication for PHP. Simple, lightweight and secure."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://horizom.github.io/docs/framework/auth/index"><link data-react-helmet="true" rel="alternate" href="https://horizom.github.io/docs/framework/auth/index" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://horizom.github.io/docs/framework/auth/index" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b4066bd3.css">
<link rel="preload" href="/assets/js/styles.2109cc9f.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.706e2a12.js" as="script">
<link rel="preload" href="/assets/js/main.935dcec4.js" as="script">
<link rel="preload" href="/assets/js/1.79adfdf9.js" as="script">
<link rel="preload" href="/assets/js/2.48832b8f.js" as="script">
<link rel="preload" href="/assets/js/3.d7eda28e.js" as="script">
<link rel="preload" href="/assets/js/1be78505.87458978.js" as="script">
<link rel="preload" href="/assets/js/50.f2266ae9.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.238efc90.js" as="script">
<link rel="preload" href="/assets/js/17896441.53e38935.js" as="script">
<link rel="preload" href="/assets/js/55f8eda8.090ff40a.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Horizom Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Horizom Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Horizom</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link navbar__link--active" href="/docs/framework">Framework</a><a class="navbar__item navbar__link" href="/docs/cms">CMS</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="searchWrapper_3rmH"><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Horizom Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Horizom Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Horizom</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/framework">Framework</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/cms">CMS</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/framework">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">auth</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/framework/auth/index">Introduction</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/framework/basics/controller">Controller</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/framework/basics/request">Request</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/framework/basics/response">Response</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">database</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/framework/database/getting-started">getting-started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/framework/database/migrations">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/framework/database/orm">orm</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">routing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/framework/routing/attaching-route-groups">Attaching Route Groups</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/framework/routing/defining-routes">Defining Routes</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Introduction</h1></header><div class="markdown"><p><strong>Authentication for PHP. Simple, lightweight and secure.</strong></p><p>Written once, to be used everywhere.</p><p>Completely framework-agnostic and database-agnostic.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h2><ul><li>PHP 7.4.1+<ul><li>PDO (PHP Data Objects) extension (<code>pdo</code>)<ul><li>MySQL Native Driver (<code>mysqlnd</code>) <strong>or</strong> PostgreSQL driver (<code>pgsql</code>) <strong>or</strong> SQLite driver (<code>sqlite</code>)</li></ul></li><li>OpenSSL extension (<code>openssl</code>)</li></ul></li><li>MySQL 5.5.3+ <strong>or</strong> MariaDB 5.5.23+ <strong>or</strong> PostgreSQL 9.5.10+ <strong>or</strong> SQLite 3.14.1+ <strong>or</strong> <a href="/docs/framework/auth/Database">other SQL databases</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installation"></a>Installation<a class="hash-link" href="#installation" title="Direct link to heading">#</a></h2><ol><li><p>Include the library via Composer <a href="https://github.com/delight-im/Knowledge/blob/master/Composer%20(PHP).md" target="_blank" rel="noopener noreferrer">[?]</a>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token function" style="color:rgb(250, 208, 0)">composer</span><span class="token plain"> require delight-im/auth</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Include the Composer autoloader:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">require __DIR__ . &#x27;/vendor/autoload.php&#x27;;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Set up a database and create the required tables:</p><ul><li><a href="/docs/framework/auth/Database/MySQL.sql">MariaDB</a></li><li><a href="/docs/framework/auth/Database/MySQL.sql">MySQL</a></li><li><a href="/docs/framework/auth/Database/PostgreSQL.sql">PostgreSQL</a></li><li><a href="/docs/framework/auth/Database/SQLite.sql">SQLite</a></li></ul></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="usage"></a>Usage<a class="hash-link" href="#usage" title="Direct link to heading">#</a></h2><ul><li><a href="#requirements">Requirements</a></li><li><a href="#installation">Installation</a></li><li><a href="#usage">Usage</a><ul><li><a href="#creating-a-new-instance">Creating a new instance</a></li><li><a href="#registration-sign-up">Registration (sign up)</a></li><li><a href="#login-sign-in">Login (sign in)</a></li><li><a href="#email-verification">Email verification</a></li><li><a href="#keeping-the-user-logged-in">Keeping the user logged in</a></li><li><a href="#password-reset-forgot-password">Password reset (“forgot password”)</a><ul><li><a href="#step-1-of-3-initiating-the-request">Step 1 of 3: Initiating the request</a></li><li><a href="#step-2-of-3-verifying-an-attempt">Step 2 of 3: Verifying an attempt</a></li><li><a href="#step-3-of-3-updating-the-password">Step 3 of 3: Updating the password</a></li></ul></li><li><a href="#changing-the-current-users-password">Changing the current user’s password</a></li><li><a href="#changing-the-current-users-email-address">Changing the current user’s email address</a></li><li><a href="#re-sending-confirmation-requests">Re-sending confirmation requests</a></li><li><a href="#logout">Logout</a></li><li><a href="#accessing-user-information">Accessing user information</a><ul><li><a href="#login-state">Login state</a></li><li><a href="#user-id">User ID</a></li><li><a href="#email-address">Email address</a></li><li><a href="#display-name">Display name</a></li><li><a href="#status-information">Status information</a></li><li><a href="#checking-whether-the-user-was-remembered">Checking whether the user was “remembered”</a></li><li><a href="#ip-address">IP address</a></li><li><a href="#additional-user-information">Additional user information</a></li></ul></li><li><a href="#reconfirming-the-users-password">Reconfirming the user’s password</a></li><li><a href="#roles-or-groups">Roles (or groups)</a><ul><li><a href="#checking-roles">Checking roles</a></li><li><a href="#available-roles">Available roles</a></li><li><a href="#permissions-or-access-rights-privileges-or-capabilities">Permissions (or access rights, privileges or capabilities)</a></li><li><a href="#custom-role-names">Custom role names</a></li></ul></li><li><a href="#enabling-or-disabling-password-resets">Enabling or disabling password resets</a></li><li><a href="#throttling-or-rate-limiting">Throttling or rate limiting</a></li><li><a href="#administration-managing-users">Administration (managing users)</a><ul><li><a href="#creating-new-users">Creating new users</a></li><li><a href="#deleting-users">Deleting users</a></li><li><a href="#retrieving-a-list-of-registered-users">Retrieving a list of registered users</a></li><li><a href="#assigning-roles-to-users">Assigning roles to users</a></li><li><a href="#taking-roles-away-from-users">Taking roles away from users</a></li><li><a href="#checking-roles-1">Checking roles</a></li><li><a href="#impersonating-users-logging-in-as-user">Impersonating users (logging in as user)</a></li><li><a href="#changing-a-users-password">Changing a user’s password</a></li></ul></li><li><a href="#cookies">Cookies</a><ul><li><a href="#renaming-the-librarys-cookies">Renaming the library’s cookies</a></li><li><a href="#defining-the-domain-scope-for-cookies">Defining the domain scope for cookies</a></li><li><a href="#restricting-the-path-where-cookies-are-available">Restricting the path where cookies are available</a></li><li><a href="#controlling-client-side-script-access-to-cookies">Controlling client-side script access to cookies</a></li><li><a href="#configuring-transport-security-for-cookies">Configuring transport security for cookies</a></li></ul></li><li><a href="#utilities">Utilities</a><ul><li><a href="#creating-a-random-string">Creating a random string</a></li><li><a href="#creating-a-uuid-v4-as-per-rfc-4122">Creating a UUID v4 as per RFC 4122</a></li></ul></li><li><a href="#reading-and-writing-session-data">Reading and writing session data</a></li></ul></li><li><a href="#frequently-asked-questions">Frequently asked questions</a><ul><li><a href="#what-about-password-hashing">What about password hashing?</a></li><li><a href="#how-can-i-implement-custom-password-requirements">How can I implement custom password requirements?</a></li><li><a href="#why-are-there-problems-when-using-other-libraries-that-work-with-sessions">Why are there problems when using other libraries that work with sessions?</a></li><li><a href="#why-are-other-sites-not-able-to-frame-or-embed-my-site">Why are other sites not able to frame or embed my site?</a></li></ul></li><li><a href="#exceptions">Exceptions</a></li><li><a href="#general-advice">General advice</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-a-new-instance"></a>Creating a new instance<a class="hash-link" href="#creating-a-new-instance" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$db = new \PDO(&#x27;mysql:dbname=my-database;host=localhost;charset=utf8mb4&#x27;, &#x27;my-username&#x27;, &#x27;my-password&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">$db = new \PDO(&#x27;pgsql:dbname=my-database;host=localhost;port=5432&#x27;, &#x27;my-username&#x27;, &#x27;my-password&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">$db = new \PDO(&#x27;sqlite:../Databases/my-database.sqlite&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">$auth = new \Horizom\Auth\Auth($db);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you have an open <code>PDO</code> connection already, just re-use it. The database user (e.g. <code>my-username</code>) needs at least the privileges <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> for the tables used by this library (or their parent database).</p><p>If your web server is behind a proxy server and <code>$_SERVER[&#x27;REMOTE_ADDR&#x27;]</code> only contains the proxy’s IP address, you must pass the user’s real IP address to the constructor in the second argument, which is named <code>$ipAddress</code>. The default is the usual remote IP address received by PHP.</p><p>Should your database tables for this library need a common prefix, e.g. <code>my_users</code> instead of <code>users</code> (and likewise for the other tables), pass the prefix (e.g. <code>my_</code>) as the third parameter to the constructor, which is named <code>$dbTablePrefix</code>. This is optional and the prefix is empty by default.</p><p>During development, you may want to disable the request limiting or throttling performed by this library. To do so, pass <code>false</code> to the constructor as the fourth argument, which is named <code>$throttling</code>. The feature is enabled by default.</p><p>During the lifetime of a session, some user data may be changed remotely, either by a client in another session or by an administrator. That means this information must be regularly resynchronized with its authoritative source in the database, which this library does automatically. By default, this happens every five minutes. If you want to change this interval, pass a custom interval in seconds to the constructor as the fifth argument, which is named <code>$sessionResyncInterval</code>.</p><p>If all your database tables need a common database name, schema name, or other qualifier that must be specified explicitly, you can optionally pass that qualifier to the constructor as the sixth parameter, which is named <code>$dbSchema</code>.</p><p>If you want to use a <code>PdoDatabase</code> instance (e.g. <code>$db</code>) independently as well, please refer to the <a href="https://github.com/delight-im/PHP-DB" target="_blank" rel="noopener noreferrer">documentation of the database library</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="registration-sign-up"></a>Registration (sign up)<a class="hash-link" href="#registration-sign-up" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $userId = $auth-&gt;register($_POST[&#x27;email&#x27;], $_POST[&#x27;password&#x27;], $_POST[&#x27;username&#x27;], function ($selector, $token) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;Send &#x27; . $selector . &#x27; and &#x27; . $token . &#x27; to the user (e.g. via email)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    });</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;We have signed up a new user with the ID &#x27; . $userId;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\InvalidPasswordException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid password&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\UserAlreadyExistsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;User already exists&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> The anonymous callback function is a <a href="https://www.php.net/manual/functions.anonymous.php" target="_blank" rel="noopener noreferrer">closure</a>. Thus, besides its own parameters, only <a href="https://www.php.net/manual/language.variables.superglobals.php" target="_blank" rel="noopener noreferrer">superglobals</a> like <code>$_GET</code>, <code>$_POST</code>, <code>$_COOKIE</code> and <code>$_SERVER</code> are available inside. For any other variable from the parent scope, you need to explicitly make a copy available inside by adding a <code>use</code> clause after the parameter list.</p><p>The username in the third parameter is optional. You can pass <code>null</code> there if you don’t want to manage usernames.</p><p>If you want to enforce unique usernames, on the other hand, simply call <code>registerWithUniqueUsername</code> instead of <code>register</code>, and be prepared to catch the <code>DuplicateUsernameException</code>.</p><p><strong>Note:</strong> When accepting and managing usernames, you may want to exclude non-printing control characters and certain printable special characters, as in the character class <code>[\x00-\x1f\x7f\/:\\]</code>. In order to do so, you could wrap the call to <code>Auth#register</code> or <code>Auth#registerWithUniqueUsername</code> inside a conditional branch, for example by only accepting usernames when the following condition is satisfied:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">if (\preg_match(&#x27;/[\x00-\x1f\x7f\/:\\\\]/&#x27;, $username) === 0) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    // ...</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>For email verification, you should build an URL with the selector and token and send it to the user, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$url = &#x27;https://www.example.com/verify_email?selector=&#x27; . \urlencode($selector) . &#x27;&amp;token=&#x27; . \urlencode($token);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you don’t want to perform email verification, just omit the last parameter to <code>Auth#register</code>. The new user will be active immediately, then.</p><p>Need to store additional user information? Read on <a href="#additional-user-information">here</a>.</p><p><strong>Note:</strong> When sending an email to the user, please note that the (optional) username, at this point, has not yet been confirmed as acceptable to the owner of the (new) email address. It could contain offensive or misleading language chosen by someone who is not actually the owner of the address.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="login-sign-in"></a>Login (sign in)<a class="hash-link" href="#login-sign-in" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;login($_POST[&#x27;email&#x27;], $_POST[&#x27;password&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User is logged in&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Wrong email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\InvalidPasswordException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Wrong password&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\EmailNotVerifiedException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Email not verified&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you want to sign in with usernames on the other hand, either in addition to the login via email address or as a replacement, that’s possible as well. Simply call the method <code>loginWithUsername</code> instead of method <code>login</code>. Then, instead of catching <code>InvalidEmailException</code>, make sure to catch both <code>UnknownUsernameException</code> and <code>AmbiguousUsernameException</code>. You may also want to read the notes about the uniqueness of usernames in the section that explains how to <a href="#registration-sign-up">sign up new users</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="email-verification"></a>Email verification<a class="hash-link" href="#email-verification" title="Direct link to heading">#</a></h3><p>Extract the selector and token from the URL that the user clicked on in the verification email.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;confirmEmail($_GET[&#x27;selector&#x27;], $_GET[&#x27;token&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Email address has been verified&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\InvalidSelectorTokenPairException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid token&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\TokenExpiredException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Token expired&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\UserAlreadyExistsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Email address already exists&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you want the user to be automatically signed in after successful confirmation, just call <code>confirmEmailAndSignIn</code> instead of <code>confirmEmail</code>. That alternative method also supports <a href="#keeping-the-user-logged-in">persistent logins</a> via its optional third parameter.</p><p>On success, the two methods <code>confirmEmail</code> and <code>confirmEmailAndSignIn</code> both return an array with the user’s new email address, which has just been verified, at index one. If the confirmation was for an address change instead of a simple address verification, the user’s old email address will be included in the array at index zero.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="keeping-the-user-logged-in"></a>Keeping the user logged in<a class="hash-link" href="#keeping-the-user-logged-in" title="Direct link to heading">#</a></h3><p>The third parameter to the <code>Auth#login</code> and <code>Auth#confirmEmailAndSignIn</code> methods controls whether the login is persistent with a long-lived cookie. With such a persistent login, users may stay authenticated for a long time, even when the browser session has already been closed and the session cookies have expired. Typically, you’ll want to keep the user logged in for weeks or months with this feature, which is known as “remember me” or “keep me logged in”. Many users will find this more convenient, but it may be less secure if they leave their devices unattended.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($_POST[&#x27;remember&#x27;] == 1) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    // keep logged in for one year</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $rememberDuration = (int) (60 * 60 * 24 * 365.25);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">else {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    // do not keep logged in after session ends</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $rememberDuration = null;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// ...</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">$auth-&gt;login($_POST[&#x27;email&#x27;], $_POST[&#x27;password&#x27;], $rememberDuration);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><em>Without</em> the persistent login, which is the <em>default</em> behavior, a user will only stay logged in until they close their browser, or as long as configured via <code>session.cookie_lifetime</code> and <code>session.gc_maxlifetime</code> in PHP.</p><p>Omit the third parameter or set it to <code>null</code> to disable the feature. Otherwise, you may ask the user whether they want to enable “remember me”. This is usually done with a checkbox in your user interface. Use the input from that checkbox to decide between <code>null</code> and a pre-defined duration in seconds here, e.g. <code>60 * 60 * 24 * 365.25</code> for one year.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="password-reset-forgot-password"></a>Password reset (“forgot password”)<a class="hash-link" href="#password-reset-forgot-password" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-1-of-3-initiating-the-request"></a>Step 1 of 3: Initiating the request<a class="hash-link" href="#step-1-of-3-initiating-the-request" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;forgotPassword($_POST[&#x27;email&#x27;], function ($selector, $token) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;Send &#x27; . $selector . &#x27; and &#x27; . $token . &#x27; to the user (e.g. via email)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    });</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Request has been generated&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\EmailNotVerifiedException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Email not verified&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\ResetDisabledException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Password reset is disabled&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> The anonymous callback function is a <a href="https://www.php.net/manual/functions.anonymous.php" target="_blank" rel="noopener noreferrer">closure</a>. Thus, besides its own parameters, only <a href="https://www.php.net/manual/language.variables.superglobals.php" target="_blank" rel="noopener noreferrer">superglobals</a> like <code>$_GET</code>, <code>$_POST</code>, <code>$_COOKIE</code> and <code>$_SERVER</code> are available inside. For any other variable from the parent scope, you need to explicitly make a copy available inside by adding a <code>use</code> clause after the parameter list.</p><p>You should build an URL with the selector and token and send it to the user, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$url = &#x27;https://www.example.com/reset_password?selector=&#x27; . \urlencode($selector) . &#x27;&amp;token=&#x27; . \urlencode($token);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the default lifetime of the password reset requests does not work for you, you can use the third parameter of <code>Auth#forgotPassword</code> to specify a custom interval in seconds after which the requests should expire.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-2-of-3-verifying-an-attempt"></a>Step 2 of 3: Verifying an attempt<a class="hash-link" href="#step-2-of-3-verifying-an-attempt" title="Direct link to heading">#</a></h4><p>As the next step, users will click on the link that they received. Extract the selector and token from the URL.</p><p>If the selector/token pair is valid, let the user choose a new password:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;canResetPasswordOrThrow($_GET[&#x27;selector&#x27;], $_GET[&#x27;token&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Put the selector into a &quot;hidden&quot; field (or keep it in the URL)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Put the token into a &quot;hidden&quot; field (or keep it in the URL)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Ask the user for their new password&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\InvalidSelectorTokenPairException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid token&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\TokenExpiredException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Token expired&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\ResetDisabledException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Password reset is disabled&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Horizom\Auth\Exception\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Alternatively, if you don’t need any error messages but only want to check the validity, you can use the slightly simpler version:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;canResetPassword($_GET[&#x27;selector&#x27;], $_GET[&#x27;token&#x27;])) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Put the selector into a &quot;hidden&quot; field (or keep it in the URL)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Put the token into a &quot;hidden&quot; field (or keep it in the URL)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Ask the user for their new password&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-3-of-3-updating-the-password"></a>Step 3 of 3: Updating the password<a class="hash-link" href="#step-3-of-3-updating-the-password" title="Direct link to heading">#</a></h4><p>Now when you have the new password for the user (and still have the other two pieces of information), you can reset the password:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;resetPassword($_POST[&#x27;selector&#x27;], $_POST[&#x27;token&#x27;], $_POST[&#x27;password&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Password has been reset&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidSelectorTokenPairException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid token&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TokenExpiredException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Token expired&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\ResetDisabledException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Password reset is disabled&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidPasswordException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid password&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Do you want to have the respective user signed in automatically when their password reset succeeds? Simply use <code>Auth#resetPasswordAndSignIn</code> instead of <code>Auth#resetPassword</code> to log in the user immediately.</p><p>If you need the user’s ID or email address, e.g. for sending them a notification that their password has successfully been reset, just use the return value of <code>Auth#resetPassword</code>, which is an array containing two entries named <code>id</code> and <code>email</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="changing-the-current-users-password"></a>Changing the current user’s password<a class="hash-link" href="#changing-the-current-users-password" title="Direct link to heading">#</a></h3><p>If a user is currently logged in, they may change their password.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;changePassword($_POST[&#x27;oldPassword&#x27;], $_POST[&#x27;newPassword&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Password has been changed&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\NotLoggedInException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Not logged in&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidPasswordException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid password(s)&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Asking the user for their current (and soon <em>old</em>) password and requiring it for verification is the recommended way to handle password changes. This is shown above.</p><p>If you’re sure that you don’t need that confirmation, however, you may call <code>changePasswordWithoutOldPassword</code> instead of <code>changePassword</code> and drop the first parameter from that method call (which would otherwise contain the old password).</p><p>In any case, after the user’s password has been changed, you should send an email to their account’s primary email address as an out-of-band notification informing the account owner about this critical change.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="changing-the-current-users-email-address"></a>Changing the current user’s email address<a class="hash-link" href="#changing-the-current-users-email-address" title="Direct link to heading">#</a></h3><p>If a user is currently logged in, they may change their email address.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    if ($auth-&gt;reconfirmPassword($_POST[&#x27;password&#x27;])) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        $auth-&gt;changeEmail($_POST[&#x27;newEmail&#x27;], function ($selector, $token) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">            echo &#x27;Send &#x27; . $selector . &#x27; and &#x27; . $token . &#x27; to the user (e.g. via email to the *new* address)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        });</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;The change will take effect as soon as the new email address has been confirmed&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    else {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;We can\&#x27;t say if the user is who they claim to be&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UserAlreadyExistsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Email address already exists&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\EmailNotVerifiedException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Account not verified&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\NotLoggedInException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Not logged in&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> The anonymous callback function is a <a href="https://www.php.net/manual/functions.anonymous.php" target="_blank" rel="noopener noreferrer">closure</a>. Thus, besides its own parameters, only <a href="https://www.php.net/manual/language.variables.superglobals.php" target="_blank" rel="noopener noreferrer">superglobals</a> like <code>$_GET</code>, <code>$_POST</code>, <code>$_COOKIE</code> and <code>$_SERVER</code> are available inside. For any other variable from the parent scope, you need to explicitly make a copy available inside by adding a <code>use</code> clause after the parameter list.</p><p>For email verification, you should build an URL with the selector and token and send it to the user, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$url = &#x27;https://www.example.com/verify_email?selector=&#x27; . \urlencode($selector) . &#x27;&amp;token=&#x27; . \urlencode($token);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> When sending an email to the user, please note that the (optional) username, at this point, has not yet been confirmed as acceptable to the owner of the (new) email address. It could contain offensive or misleading language chosen by someone who is not actually the owner of the address.</p><p>After the request to change the email address has been made, or even better, after the change has been confirmed by the user, you should send an email to their account’s <em>previous</em> email address as an out-of-band notification informing the account owner about this critical change.</p><p><strong>Note:</strong> Changes to a user’s email address take effect in the local session immediately, as expected. In other sessions (e.g. on other devices), the changes may need up to five minutes to take effect, though. This increases performance and usually poses no problem. If you want to change this behavior, nevertheless, simply decrease (or perhaps increase) the value that you pass to the <a href="#creating-a-new-instance"><code>Auth</code> constructor</a> as the argument named <code>$sessionResyncInterval</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="re-sending-confirmation-requests"></a>Re-sending confirmation requests<a class="hash-link" href="#re-sending-confirmation-requests" title="Direct link to heading">#</a></h3><p>If an earlier confirmation request could not be delivered to the user, or if the user missed that request, or if they just don’t want to wait any longer, you may re-send an earlier request like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;resendConfirmationForEmail($_POST[&#x27;email&#x27;], function ($selector, $token) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;Send &#x27; . $selector . &#x27; and &#x27; . $token . &#x27; to the user (e.g. via email)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    });</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;The user may now respond to the confirmation request (usually by clicking a link)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\ConfirmationRequestNotFound $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;No earlier request found that could be re-sent&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;There have been too many requests -- try again later&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you want to specify the user by their ID instead of by their email address, this is possible as well:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;resendConfirmationForUserId($_POST[&#x27;userId&#x27;], function ($selector, $token) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;Send &#x27; . $selector . &#x27; and &#x27; . $token . &#x27; to the user (e.g. via email)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    });</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;The user may now respond to the confirmation request (usually by clicking a link)&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\ConfirmationRequestNotFound $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;No earlier request found that could be re-sent&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;There have been too many requests -- try again later&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> The anonymous callback function is a <a href="https://www.php.net/manual/functions.anonymous.php" target="_blank" rel="noopener noreferrer">closure</a>. Thus, besides its own parameters, only <a href="https://www.php.net/manual/language.variables.superglobals.php" target="_blank" rel="noopener noreferrer">superglobals</a> like <code>$_GET</code>, <code>$_POST</code>, <code>$_COOKIE</code> and <code>$_SERVER</code> are available inside. For any other variable from the parent scope, you need to explicitly make a copy available inside by adding a <code>use</code> clause after the parameter list.</p><p>Usually, you should build an URL with the selector and token and send it to the user, e.g. as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$url = &#x27;https://www.example.com/verify_email?selector=&#x27; . \urlencode($selector) . &#x27;&amp;token=&#x27; . \urlencode($token);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> When sending an email to the user, please note that the (optional) username, at this point, has not yet been confirmed as acceptable to the owner of the (new) email address. It could contain offensive or misleading language chosen by someone who is not actually the owner of the address.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="logout"></a>Logout<a class="hash-link" href="#logout" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$auth-&gt;logOut();</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;logOutEverywhereElse();</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\NotLoggedInException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Not logged in&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;logOutEverywhere();</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\NotLoggedInException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Not logged in&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Additionally, if you store custom information in the session as well, and if you want that information to be deleted, you can destroy the entire session by calling a second method:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$auth-&gt;destroySession();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> Global logouts take effect in the local session immediately, as expected. In other sessions (e.g. on other devices), the changes may need up to five minutes to take effect, though. This increases performance and usually poses no problem. If you want to change this behavior, nevertheless, simply decrease (or perhaps increase) the value that you pass to the <a href="#creating-a-new-instance"><code>Auth</code> constructor</a> as the argument named <code>$sessionResyncInterval</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="accessing-user-information"></a>Accessing user information<a class="hash-link" href="#accessing-user-information" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="login-state"></a>Login state<a class="hash-link" href="#login-state" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;isLoggedIn()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User is signed in&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">else {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User is not signed in yet&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>A shorthand/alias for this method is <code>$auth-&gt;check()</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="user-id"></a>User ID<a class="hash-link" href="#user-id" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$id = $auth-&gt;getUserId();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the user is not currently signed in, this returns <code>null</code>.</p><p>A shorthand/alias for this method is <code>$auth-&gt;id()</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="email-address"></a>Email address<a class="hash-link" href="#email-address" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$email = $auth-&gt;getEmail();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the user is not currently signed in, this returns <code>null</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="display-name"></a>Display name<a class="hash-link" href="#display-name" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$username = $auth-&gt;getUsername();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Remember that usernames are optional and there is only a username if you supplied it during registration.</p><p>If the user is not currently signed in, this returns <code>null</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="status-information"></a>Status information<a class="hash-link" href="#status-information" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;isNormal()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User is in default state&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;isArchived()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User has been archived&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;isBanned()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User has been banned&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;isLocked()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User has been locked&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;isPendingReview()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User is pending review&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;isSuspended()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User has been suspended&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="checking-whether-the-user-was-remembered"></a>Checking whether the user was “remembered”<a class="hash-link" href="#checking-whether-the-user-was-remembered" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;isRemembered()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User did not sign in but was logged in through their long-lived cookie&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">else {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;User signed in manually&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the user is not currently signed in, this returns <code>null</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ip-address"></a>IP address<a class="hash-link" href="#ip-address" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$ip = $auth-&gt;getIpAddress();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="additional-user-information"></a>Additional user information<a class="hash-link" href="#additional-user-information" title="Direct link to heading">#</a></h4><p>In order to preserve this library’s suitability for all purposes as well as its full re-usability, it doesn’t come with additional bundled columns for user information. But you don’t have to do without additional user information, of course:</p><p>Here’s how to use this library with your own tables for custom user information in a maintainable and re-usable way:</p><ol><li><p>Add any number of custom database tables where you store custom user information, e.g. a table named <code>profiles</code>.</p></li><li><p>Whenever you call the <code>register</code> method (which returns the new user’s ID), add your own logic afterwards that fills your custom database tables.</p></li><li><p>If you need the custom user information only rarely, you may just retrieve it as needed. If you need it more frequently, however, you’d probably want to have it in your session data. The following method is how you can load and access your data in a reliable way:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">function getUserInfo(\Delight\Auth\Auth $auth) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    if (!$auth-&gt;isLoggedIn()) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        return null;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    if (!isset($_SESSION[&#x27;_internal_user_info&#x27;])) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        // TODO: load your custom user information and assign it to the session variable below</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        // $_SESSION[&#x27;_internal_user_info&#x27;] = ...</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    return $_SESSION[&#x27;_internal_user_info&#x27;];</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reconfirming-the-users-password"></a>Reconfirming the user’s password<a class="hash-link" href="#reconfirming-the-users-password" title="Direct link to heading">#</a></h3><p>Whenever you want to confirm the user’s identity again, e.g. before the user is allowed to perform some “dangerous” action, you should verify their password again to confirm that they actually are who they claim to be.</p><p>For example, when a user has been remembered by a long-lived cookie and thus <code>Auth#isRemembered</code> returns <code>true</code>, this means that the user probably has not entered their password for quite some time anymore. You may want to reconfirm their password in that case.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    if ($auth-&gt;reconfirmPassword($_POST[&#x27;password&#x27;])) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;The user really seems to be who they claim to be&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    else {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;We can\&#x27;t say if the user is who they claim to be&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\NotLoggedInException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;The user is not signed in&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="roles-or-groups"></a>Roles (or groups)<a class="hash-link" href="#roles-or-groups" title="Direct link to heading">#</a></h3><p>Every user can have any number of roles, which you can use to implement authorization and to refine your access controls.</p><p>Users may have no role at all (which they do by default), exactly one role, or any arbitrary combination of roles.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="checking-roles"></a>Checking roles<a class="hash-link" href="#checking-roles" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;hasRole(\Delight\Auth\Role::SUPER_MODERATOR)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;The user is a super moderator&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;hasAnyRole(\Delight\Auth\Role::DEVELOPER, \Delight\Auth\Role::MANAGER)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;The user is either a developer, or a manager, or both&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if ($auth-&gt;hasAllRoles(\Delight\Auth\Role::DEVELOPER, \Delight\Auth\Role::MANAGER)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;The user is both a developer and a manager&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>While the method <code>hasRole</code> takes exactly one role as its argument, the two methods <code>hasAnyRole</code> and <code>hasAllRoles</code> can take any number of roles that you would like to check for.</p><p>Alternatively, you can get a list of all the roles that have been assigned to the user:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$auth-&gt;getRoles();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="available-roles"></a>Available roles<a class="hash-link" href="#available-roles" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::ADMIN;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::AUTHOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::COLLABORATOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::CONSULTANT;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::CONSUMER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::CONTRIBUTOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::COORDINATOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::CREATOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::DEVELOPER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::DIRECTOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::EDITOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::EMPLOYEE;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::MAINTAINER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::MANAGER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::MODERATOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::PUBLISHER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::REVIEWER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::SUBSCRIBER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::SUPER_ADMIN;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::SUPER_EDITOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::SUPER_MODERATOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::TRANSLATOR;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can use any of these roles and ignore those that you don’t need. The list above can also be retrieved programmatically, in one of three formats:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::getMap();</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::getNames();</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::getValues();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="permissions-or-access-rights-privileges-or-capabilities"></a>Permissions (or access rights, privileges or capabilities)<a class="hash-link" href="#permissions-or-access-rights-privileges-or-capabilities" title="Direct link to heading">#</a></h4><p>The permissions of each user are encoded in the way that role requirements are specified throughout your code base. If those requirements are evaluated with a specific user’s set of roles, implicitly checked permissions are the result.</p><p>For larger projects, it is often recommended to maintain the definition of permissions in a single place. You then don’t check for <em>roles</em> in your business logic, but you check for <em>individual permissions</em>. You could implement that concept as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">function canEditArticle(\Delight\Auth\Auth $auth) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    return $auth-&gt;hasAnyRole(</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        \Delight\Auth\Role::MODERATOR,</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        \Delight\Auth\Role::SUPER_MODERATOR,</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        \Delight\Auth\Role::ADMIN,</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        \Delight\Auth\Role::SUPER_ADMIN</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    );</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// ...</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if (canEditArticle($auth)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;The user can edit articles here&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// ...</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if (canEditArticle($auth)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;... and here&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// ...</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if (canEditArticle($auth)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;... and here&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>As you can see, the permission of whether a certain user can edit an article is stored at a central location. This implementation has two major advantages:</p><p>If you <em>want to know</em> which users can edit articles, you don’t have to check your business logic in various places, but you only have to look where the specific permission is defined. And if you want to <em>change</em> who can edit an article, you only have to do this in one single place as well, not throughout your whole code base.</p><p>But this also comes with slightly more overhead when implementing the access restrictions for the first time, which may or may not be worth it for your project.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="custom-role-names"></a>Custom role names<a class="hash-link" href="#custom-role-names" title="Direct link to heading">#</a></h4><p>If the names of the included roles don’t work for you, you can alias any number of roles using your own identifiers, e.g. like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">namespace My\Namespace;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">final class MyRole {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    const CUSTOMER_SERVICE_AGENT = \Delight\Auth\Role::REVIEWER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    const FINANCIAL_DIRECTOR = \Delight\Auth\Role::COORDINATOR;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    private function __construct() {}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The example above would allow you to use</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\My\Namespace\MyRole::CUSTOMER_SERVICE_AGENT;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// and</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\My\Namespace\MyRole::FINANCIAL_DIRECTOR;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>instead of</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::REVIEWER;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// and</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Role::COORDINATOR;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Just remember <em>not</em> to alias a <em>single</em> included role to <em>multiple</em> roles with custom names.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="enabling-or-disabling-password-resets"></a>Enabling or disabling password resets<a class="hash-link" href="#enabling-or-disabling-password-resets" title="Direct link to heading">#</a></h3><p>While password resets via email are a convenient feature that most users find helpful from time to time, the availability of this feature implies that accounts on your service are only ever as secure as the user’s associated email account.</p><p>You may provide security-conscious (and experienced) users with the possibility to disable password resets for their accounts (and to enable them again later) for enhanced security:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    if ($auth-&gt;reconfirmPassword($_POST[&#x27;password&#x27;])) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        $auth-&gt;setPasswordResetEnabled($_POST[&#x27;enabled&#x27;] == 1);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;The setting has been changed&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    else {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;We can\&#x27;t say if the user is who they claim to be&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\NotLoggedInException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;The user is not signed in&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Too many requests&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In order to check the current value of this setting, use the return value from</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$auth-&gt;isPasswordResetEnabled();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>for the correct default option in your user interface. You don’t need to check this value for restrictions of the feature, which are enforced automatically.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="throttling-or-rate-limiting"></a>Throttling or rate limiting<a class="hash-link" href="#throttling-or-rate-limiting" title="Direct link to heading">#</a></h3><p>All methods provided by this library are <em>automatically</em> protected against excessive numbers of requests from clients. If the need arises, you can (temporarily) disable this protection using the <a href="#creating-a-new-instance"><code>$throttling</code> parameter</a> passed to the constructor.</p><p>If you would like to throttle or rate limit <em>external</em> features or methods as well, e.g. those in your own code, you can make use of the built-in helper method for throttling and rate limiting:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    // throttle the specified resource or feature to *3* requests per *60* seconds</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;throttle([ &#x27;my-resource-name&#x27; ], 3, 60);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;Do something with the resource or feature&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\TooManyRequestsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    // operation cancelled</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    \http_response_code(429);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    exit;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the protection of the resource or feature should additionally depend on another attribute, e.g. to track something separately per IP address, just add more data to the resource description, such as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">[ &#x27;my-resource-name&#x27;, $_SERVER[&#x27;REMOTE_ADDR&#x27;] ]</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// instead of</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// [ &#x27;my-resource-name&#x27; ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Allowing short bursts of activity during peak demand is possible by specifying a burst factor as the fourth argument. A value of <code>5</code>, for example, would permit temporary bursts of fivefold activity, compared to the generally accepted level.</p><p>In some cases, you may just want to <em>simulate</em> the throttling or rate limiting. This lets you check whether an action would be permitted without actually modifying the activity tracker. To do so, simply pass <code>true</code> as the fifth argument.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="administration-managing-users"></a>Administration (managing users)<a class="hash-link" href="#administration-managing-users" title="Direct link to heading">#</a></h3><p>The administrative interface is available via <code>$auth-&gt;admin()</code>. You can call various method on this interface, as documented below.</p><p>Do not forget to implement secure access control before exposing access to this interface. For example, you may provide access to this interface to logged in users with the administrator role only, or use the interface in private scripts only.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-new-users"></a>Creating new users<a class="hash-link" href="#creating-new-users" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $userId = $auth-&gt;admin()-&gt;createUser($_POST[&#x27;email&#x27;], $_POST[&#x27;password&#x27;], $_POST[&#x27;username&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    echo &#x27;We have signed up a new user with the ID &#x27; . $userId;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidPasswordException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid password&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UserAlreadyExistsException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;User already exists&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The username in the third parameter is optional. You can pass <code>null</code> there if you don’t want to manage usernames.</p><p>If you want to enforce unique usernames, on the other hand, simply call <code>createUserWithUniqueUsername</code> instead of <code>createUser</code>, and be prepared to catch the <code>DuplicateUsernameException</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deleting-users"></a>Deleting users<a class="hash-link" href="#deleting-users" title="Direct link to heading">#</a></h4><p>Deleting users by their ID:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;deleteUserById($_POST[&#x27;id&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownIdException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown ID&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Deleting users by their email address:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;deleteUserByEmail($_POST[&#x27;email&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Deleting users by their username:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;deleteUserByUsername($_POST[&#x27;username&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\AmbiguousUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Ambiguous username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="retrieving-a-list-of-registered-users"></a>Retrieving a list of registered users<a class="hash-link" href="#retrieving-a-list-of-registered-users" title="Direct link to heading">#</a></h4><p>When fetching a list of all users, the requirements vary greatly between projects and use cases, and customization is common. For example, you might want to fetch different columns, join related tables, filter by certain criteria, change how results are sorted (in varying direction), and limit the number of results (while providing an offset).</p><p>That’s why it’s easier to use a single custom SQL query. Start with the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token keyword" style="color:rgb(255, 157, 0)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> email</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> username</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">status</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> verified</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> roles_mask</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> registered</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> last_login </span><span class="token keyword" style="color:rgb(255, 157, 0)">FROM</span><span class="token plain"> users</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="assigning-roles-to-users"></a>Assigning roles to users<a class="hash-link" href="#assigning-roles-to-users" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;addRoleForUserById($userId, \Delight\Auth\Role::ADMIN);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownIdException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown user ID&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;addRoleForUserByEmail($userEmail, \Delight\Auth\Role::ADMIN);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;addRoleForUserByUsername($username, \Delight\Auth\Role::ADMIN);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\AmbiguousUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Ambiguous username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> Changes to a user’s set of roles may need up to five minutes to take effect. This increases performance and usually poses no problem. If you want to change this behavior, nevertheless, simply decrease (or perhaps increase) the value that you pass to the <a href="#creating-a-new-instance"><code>Auth</code> constructor</a> as the argument named <code>$sessionResyncInterval</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="taking-roles-away-from-users"></a>Taking roles away from users<a class="hash-link" href="#taking-roles-away-from-users" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;removeRoleForUserById($userId, \Delight\Auth\Role::ADMIN);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownIdException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown user ID&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;removeRoleForUserByEmail($userEmail, \Delight\Auth\Role::ADMIN);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;removeRoleForUserByUsername($username, \Delight\Auth\Role::ADMIN);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\AmbiguousUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Ambiguous username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong> Changes to a user’s set of roles may need up to five minutes to take effect. This increases performance and usually poses no problem. If you want to change this behavior, nevertheless, simply decrease (or perhaps increase) the value that you pass to the <a href="#creating-a-new-instance"><code>Auth</code> constructor</a> as the argument named <code>$sessionResyncInterval</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="checking-roles-1"></a>Checking roles<a class="hash-link" href="#checking-roles-1" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    if ($auth-&gt;admin()-&gt;doesUserHaveRole($userId, \Delight\Auth\Role::ADMIN)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;The specified user is an administrator&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    else {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        echo &#x27;The specified user is not an administrator&#x27;;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownIdException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown user ID&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Alternatively, you can get a list of all the roles that have been assigned to the user:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$auth-&gt;admin()-&gt;getRolesForUserById($userId);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="impersonating-users-logging-in-as-user"></a>Impersonating users (logging in as user)<a class="hash-link" href="#impersonating-users-logging-in-as-user" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;logInAsUserById($_POST[&#x27;id&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownIdException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown ID&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\EmailNotVerifiedException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Email address not verified&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;logInAsUserByEmail($_POST[&#x27;email&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidEmailException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown email address&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\EmailNotVerifiedException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Email address not verified&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;logInAsUserByUsername($_POST[&#x27;username&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\AmbiguousUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Ambiguous username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\EmailNotVerifiedException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Email address not verified&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="changing-a-users-password"></a>Changing a user’s password<a class="hash-link" href="#changing-a-users-password" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;changePasswordForUserById($_POST[&#x27;id&#x27;], $_POST[&#x27;newPassword&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownIdException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown ID&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidPasswordException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid password&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">// or</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">try {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;admin()-&gt;changePasswordForUserByUsername($_POST[&#x27;username&#x27;], $_POST[&#x27;newPassword&#x27;]);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\UnknownUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Unknown username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\AmbiguousUsernameException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Ambiguous username&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">catch (\Delight\Auth\InvalidPasswordException $e) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    die(&#x27;Invalid password&#x27;);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cookies"></a>Cookies<a class="hash-link" href="#cookies" title="Direct link to heading">#</a></h3><p>This library uses two cookies to keep state on the client: The first, whose name you can retrieve using</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\session_name();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>is the general (mandatory) session cookie. The second (optional) cookie is only used for <a href="#keeping-the-user-logged-in">persistent logins</a> and its name can be retrieved as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\Delight\Auth\Auth::createRememberCookieName();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="renaming-the-librarys-cookies"></a>Renaming the library’s cookies<a class="hash-link" href="#renaming-the-librarys-cookies" title="Direct link to heading">#</a></h4><p>You can rename the session cookie used by this library through one of the following means, in order of recommendation:</p><ul><li><p>In the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>), find the line with the <code>session.name</code> directive and change its value to something like <code>session_v1</code>, as in:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">session.name = session_v1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>As early as possible in your application, and before you create the <code>Auth</code> instance, call <code>\ini_set</code> to change <code>session.name</code> to something like <code>session_v1</code>, as in:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\ini_set(&#x27;session.name&#x27;, &#x27;session_v1&#x27;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> For this to work, <code>session.auto_start</code> must be set to <code>0</code> in the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>).</p></li><li><p>As early as possible in your application, and before you create the <code>Auth</code> instance, call <code>\session_name</code> with an argument like <code>session_v1</code>, as in:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\session_name(&#x27;session_v1&#x27;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> For this to work, <code>session.auto_start</code> must be set to <code>0</code> in the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>).</p></li></ul><p>The name of the cookie for <a href="#keeping-the-user-logged-in">persistent logins</a> will change as well – automatically – following your change of the session cookie’s name.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-the-domain-scope-for-cookies"></a>Defining the domain scope for cookies<a class="hash-link" href="#defining-the-domain-scope-for-cookies" title="Direct link to heading">#</a></h4><p>A cookie’s <code>domain</code> attribute controls which domain (and which subdomains) the cookie will be valid for, and thus where the user’s session and authentication state will be available.</p><p>The recommended default is an empty string, which means that the cookie will only be valid for the <em>exact</em> current host, <em>excluding</em> any subdomains that may exist. You should only use a different value if you need to share cookies between different subdomains. Often, you’ll want to share cookies between the bare domain and the <code>www</code> subdomain, but you might also want to share them between any other set of subdomains.</p><p>Whatever set of subdomains you choose, you should set the cookie’s attribute to the <em>most specific</em> domain name that still includes all your required subdomains. For example, to share cookies between <code>example.com</code> and <code>www.example.com</code>, you would set the attribute to <code>example.com</code>. But if you wanted to share cookies between <code>sub1.app.example.com</code> and <code>sub2.app.example.com</code>, you should set the attribute to <code>app.example.com</code>. Any explicitly specified domain name will always <em>include</em> all subdomains that may exist.</p><p>You can change the attribute through one of the following means, in order of recommendation:</p><ul><li><p>In the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>), find the line with the <code>session.cookie_domain</code> directive and change its value as desired, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">session.cookie_domain = example.com</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>As early as possible in your application, and before you create the <code>Auth</code> instance, call <code>\ini_set</code> to change the value of the <code>session.cookie_domain</code> directive as desired, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\ini_set(&#x27;session.cookie_domain&#x27;, &#x27;example.com&#x27;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> For this to work, <code>session.auto_start</code> must be set to <code>0</code> in the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>).</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="restricting-the-path-where-cookies-are-available"></a>Restricting the path where cookies are available<a class="hash-link" href="#restricting-the-path-where-cookies-are-available" title="Direct link to heading">#</a></h4><p>A cookie’s <code>path</code> attribute controls which directories (and subdirectories) the cookie will be valid for, and thus where the user’s session and authentication state will be available.</p><p>In most cases, you’ll want to make cookies available for all paths, i.e. any directory and file, starting in the root directory. That is what a value of <code>/</code> for the attribute does, which is also the recommended default. You should only change this attribute to a different value, e.g. <code>/path/to/subfolder</code>, if you want to restrict which directories your cookies will be available in, e.g. to host multiple applications side-by-side, in different directories, under the same domain name.</p><p>You can change the attribute through one of the following means, in order of recommendation:</p><ul><li><p>In the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>), find the line with the <code>session.cookie_path</code> directive and change its value as desired, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">session.cookie_path = /</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>As early as possible in your application, and before you create the <code>Auth</code> instance, call <code>\ini_set</code> to change the value of the <code>session.cookie_path</code> directive as desired, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\ini_set(&#x27;session.cookie_path&#x27;, &#x27;/&#x27;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> For this to work, <code>session.auto_start</code> must be set to <code>0</code> in the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>).</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="controlling-client-side-script-access-to-cookies"></a>Controlling client-side script access to cookies<a class="hash-link" href="#controlling-client-side-script-access-to-cookies" title="Direct link to heading">#</a></h4><p>Using the <code>httponly</code> attribute, you can control whether client-side scripts, i.e. JavaScript, should be able to access your cookies or not. For security reasons, it is best to <em>deny</em> script access to your cookies, which reduces the damage that successful XSS attacks against your application could do, for example.</p><p>Thus, you should always set <code>httponly</code> to <code>1</code>, except for the rare cases where you really need access to your cookies from JavaScript and can’t find any better solution. In those cases, set the attribute to <code>0</code>, but be aware of the consequences.</p><p>You can change the attribute through one of the following means, in order of recommendation:</p><ul><li><p>In the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>), find the line with the <code>session.cookie_httponly</code> directive and change its value as desired, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">session.cookie_httponly = 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>As early as possible in your application, and before you create the <code>Auth</code> instance, call <code>\ini_set</code> to change the value of the <code>session.cookie_httponly</code> directive as desired, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\ini_set(&#x27;session.cookie_httponly&#x27;, 1);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> For this to work, <code>session.auto_start</code> must be set to <code>0</code> in the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>).</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configuring-transport-security-for-cookies"></a>Configuring transport security for cookies<a class="hash-link" href="#configuring-transport-security-for-cookies" title="Direct link to heading">#</a></h4><p>Using the <code>secure</code> attribute, you can control whether cookies should be sent over <em>any</em> connection, including plain HTTP, or whether a secure connection, i.e. HTTPS (with SSL/TLS), should be required. The former (less secure) mode can be chosen by setting the attribute to <code>0</code>, and the latter (more secure) mode can be chosen by setting the attribute to <code>1</code>.</p><p>Obviously, this solely depends on whether you are able to serve <em>all</em> pages exclusively via HTTPS. If you can, you should set the attribute to <code>1</code> and possibly combine it with HTTP redirects to the secure protocol and HTTP Strict Transport Security (HSTS). Otherwise, you may have to keep the attribute set to <code>0</code>.</p><p>You can change the attribute through one of the following means, in order of recommendation:</p><ul><li><p>In the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>), find the line with the <code>session.cookie_secure</code> directive and change its value as desired, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">session.cookie_secure = 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>As early as possible in your application, and before you create the <code>Auth</code> instance, call <code>\ini_set</code> to change the value of the <code>session.cookie_secure</code> directive as desired, e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\ini_set(&#x27;session.cookie_secure&#x27;, 1);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> For this to work, <code>session.auto_start</code> must be set to <code>0</code> in the <a href="https://www.php.net/manual/configuration.file.php" target="_blank" rel="noopener noreferrer">PHP configuration</a> (<code>php.ini</code>).</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="utilities"></a>Utilities<a class="hash-link" href="#utilities" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-a-random-string"></a>Creating a random string<a class="hash-link" href="#creating-a-random-string" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$length = 24;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">$randomStr = \Delight\Auth\Auth::createRandomString($length);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-a-uuid-v4-as-per-rfc-4122"></a>Creating a UUID v4 as per RFC 4122<a class="hash-link" href="#creating-a-uuid-v4-as-per-rfc-4122" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">$uuid = \Delight\Auth\Auth::createUuid();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reading-and-writing-session-data"></a>Reading and writing session data<a class="hash-link" href="#reading-and-writing-session-data" title="Direct link to heading">#</a></h3><p>For detailed information on how to read and write session data conveniently, please refer to <a href="https://github.com/delight-im/PHP-Cookie#reading-and-writing-session-data" target="_blank" rel="noopener noreferrer">the documentation of the session library</a>, which is included by default.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="frequently-asked-questions"></a>Frequently asked questions<a class="hash-link" href="#frequently-asked-questions" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-about-password-hashing"></a>What about password hashing?<a class="hash-link" href="#what-about-password-hashing" title="Direct link to heading">#</a></h3><p>Any password or authentication token is automatically hashed using the <a href="https://en.wikipedia.org/wiki/Bcrypt" target="_blank" rel="noopener noreferrer">“bcrypt”</a> function, which is based on the <a href="https://en.wikipedia.org/wiki/Blowfish_(cipher)" target="_blank" rel="noopener noreferrer">“Blowfish” cipher</a> and (still) considered one of the strongest password hash functions today. “bcrypt” is used with 1,024 iterations, i.e. a “cost” factor of 10. A random <a href="https://en.wikipedia.org/wiki/Salt_(cryptography)" target="_blank" rel="noopener noreferrer">“salt”</a> is applied automatically as well.</p><p>You can verify this configuration by looking at the hashes in your database table <code>users</code>. If the above is true with your setup, all password hashes in your <code>users</code> table should start with the prefix <code>$2$10$</code>, <code>$2a$10$</code> or <code>$2y$10$</code>.</p><p>When new algorithms (such as <a href="https://en.wikipedia.org/wiki/Argon2" target="_blank" rel="noopener noreferrer">Argon2</a>) may be introduced in the future, this library will automatically take care of “upgrading” your existing password hashes whenever a user signs in or changes their password.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-can-i-implement-custom-password-requirements"></a>How can I implement custom password requirements?<a class="hash-link" href="#how-can-i-implement-custom-password-requirements" title="Direct link to heading">#</a></h3><p>Enforcing a minimum length for passwords is usually a good idea. Apart from that, you may want to look up whether a potential password is in some blacklist, which you could manage in a database or in a file, in order to prevent dictionary words or commonly used passwords from being used in your application.</p><p>To allow for maximum flexibility and ease of use, this library has been designed so that it does <em>not</em> contain any further checks for password requirements itself, but instead allows you to wrap your own checks around the relevant calls to library methods. Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">function isPasswordAllowed($password) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    if (\strlen($password) &lt; 8) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        return false;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $blacklist = [ &#x27;password1&#x27;, &#x27;123456&#x27;, &#x27;qwerty&#x27; ];</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    if (\in_array($password, $blacklist)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">        return false;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    }</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    return true;</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">if (isPasswordAllowed($password)) {</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">    $auth-&gt;register($email, $password);</span></div><div class="token-line" style="color:#9EFEFF"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="why-are-there-problems-when-using-other-libraries-that-work-with-sessions"></a>Why are there problems when using other libraries that work with sessions?<a class="hash-link" href="#why-are-there-problems-when-using-other-libraries-that-work-with-sessions" title="Direct link to heading">#</a></h3><p>You might try loading this library first, and creating the <code>Auth</code> instance first, <em>before</em> loading the other libraries. Apart from that, there’s probably not much we can do here.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="why-are-other-sites-not-able-to-frame-or-embed-my-site"></a>Why are other sites not able to frame or embed my site?<a class="hash-link" href="#why-are-other-sites-not-able-to-frame-or-embed-my-site" title="Direct link to heading">#</a></h3><p>If you want to let others include your site in a <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;object&gt;</code>, <code>&lt;embed&gt;</code> or <code>&lt;applet&gt;</code> element, you have to disable the default clickjacking prevention:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9EFEFF;background-color:#2D2A55"><div class="token-line" style="color:#9EFEFF"><span class="token plain">\header_remove(&#x27;X-Frame-Options&#x27;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="exceptions"></a>Exceptions<a class="hash-link" href="#exceptions" title="Direct link to heading">#</a></h2><p>This library throws two types of exceptions to indicate problems:</p><ul><li><code>AuthException</code> and its subclasses are thrown whenever a method does not complete successfully. You should <em>always</em> catch these exceptions as they carry the normal error responses that you must react to.</li><li><code>AuthError</code> and its subclasses are thrown whenever there is an internal problem or the library has not been installed correctly. You should <em>not</em> catch these exceptions.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="general-advice"></a>General advice<a class="hash-link" href="#general-advice" title="Direct link to heading">#</a></h2><ul><li>Serve <em>all</em> pages over HTTPS only, i.e. using SSL/TLS for every single request.</li><li>You should enforce a minimum length for passwords, e.g. 10 characters, but <em>never</em> any maximum length, at least not anywhere below 100 characters. Moreover, you should <em>not</em> restrict the set of allowed characters.</li><li>Whenever a user was remembered through the “remember me” feature enabled or disabled during sign in, which means that they did not log in by typing their password, you should require re-authentication for critical features.</li><li>Encourage users to use pass<em>phrases</em>, i.e. combinations of words or even full sentences, instead of single pass<em>words</em>.</li><li>Do not prevent users&#x27; password managers from working correctly. Thus, use the standard form fields only and do not prevent copy and paste.</li><li>Before executing sensitive account operations (e.g. changing a user’s email address, deleting a user’s account), you should always require re-authentication, i.e. require the user to verify their login credentials once more.</li><li>You should not offer an online password reset feature (“forgot password”) for high-security applications.</li><li>For high-security applications, you should not use email addresses as identifiers. Instead, choose identifiers that are specific to the application and secret, e.g. an internal customer number.</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/horizom/docs/edit/master/docs/framework/auth/index.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/framework/configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/framework/basics/controller"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Controller »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link">Requirements</a></li><li><a href="#installation" class="table-of-contents__link">Installation</a></li><li><a href="#usage" class="table-of-contents__link">Usage</a><ul><li><a href="#creating-a-new-instance" class="table-of-contents__link">Creating a new instance</a></li><li><a href="#registration-sign-up" class="table-of-contents__link">Registration (sign up)</a></li><li><a href="#login-sign-in" class="table-of-contents__link">Login (sign in)</a></li><li><a href="#email-verification" class="table-of-contents__link">Email verification</a></li><li><a href="#keeping-the-user-logged-in" class="table-of-contents__link">Keeping the user logged in</a></li><li><a href="#password-reset-forgot-password" class="table-of-contents__link">Password reset (“forgot password”)</a></li><li><a href="#changing-the-current-users-password" class="table-of-contents__link">Changing the current user’s password</a></li><li><a href="#changing-the-current-users-email-address" class="table-of-contents__link">Changing the current user’s email address</a></li><li><a href="#re-sending-confirmation-requests" class="table-of-contents__link">Re-sending confirmation requests</a></li><li><a href="#logout" class="table-of-contents__link">Logout</a></li><li><a href="#accessing-user-information" class="table-of-contents__link">Accessing user information</a></li><li><a href="#reconfirming-the-users-password" class="table-of-contents__link">Reconfirming the user’s password</a></li><li><a href="#roles-or-groups" class="table-of-contents__link">Roles (or groups)</a></li><li><a href="#enabling-or-disabling-password-resets" class="table-of-contents__link">Enabling or disabling password resets</a></li><li><a href="#throttling-or-rate-limiting" class="table-of-contents__link">Throttling or rate limiting</a></li><li><a href="#administration-managing-users" class="table-of-contents__link">Administration (managing users)</a></li><li><a href="#cookies" class="table-of-contents__link">Cookies</a></li><li><a href="#utilities" class="table-of-contents__link">Utilities</a></li><li><a href="#reading-and-writing-session-data" class="table-of-contents__link">Reading and writing session data</a></li></ul></li><li><a href="#frequently-asked-questions" class="table-of-contents__link">Frequently asked questions</a><ul><li><a href="#what-about-password-hashing" class="table-of-contents__link">What about password hashing?</a></li><li><a href="#how-can-i-implement-custom-password-requirements" class="table-of-contents__link">How can I implement custom password requirements?</a></li><li><a href="#why-are-there-problems-when-using-other-libraries-that-work-with-sessions" class="table-of-contents__link">Why are there problems when using other libraries that work with sessions?</a></li><li><a href="#why-are-other-sites-not-able-to-frame-or-embed-my-site" class="table-of-contents__link">Why are other sites not able to frame or embed my site?</a></li></ul></li><li><a href="#exceptions" class="table-of-contents__link">Exceptions</a></li><li><a href="#general-advice" class="table-of-contents__link">General advice</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/horizom" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/horizom" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/horizom" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/horizom" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/legal/privacy/">Privacy</a></li><li class="footer__item"><a class="footer__link-item" href="/legal/terms/">Terms</a></li><li class="footer__item"><a class="footer__link-item" href="/legal/cookie-policy/">Cookie Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.codivoire.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/cdi-logo-white.png" alt="Codivoire Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/cdi-logo-white.png" alt="Codivoire Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 Horizom, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.2109cc9f.js"></script>
<script src="/assets/js/runtime~main.706e2a12.js"></script>
<script src="/assets/js/main.935dcec4.js"></script>
<script src="/assets/js/1.79adfdf9.js"></script>
<script src="/assets/js/2.48832b8f.js"></script>
<script src="/assets/js/3.d7eda28e.js"></script>
<script src="/assets/js/1be78505.87458978.js"></script>
<script src="/assets/js/50.f2266ae9.js"></script>
<script src="/assets/js/935f2afb.238efc90.js"></script>
<script src="/assets/js/17896441.53e38935.js"></script>
<script src="/assets/js/55f8eda8.090ff40a.js"></script>
</body>
</html>